<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

	<mapper namespace="lounge">
	<insert id="insert" parameterType="loungeVO">
		insert into lounge (lounge_id, lounge_pet_type, member_user_id, lounge_title, lounge_content, lounge_writer, lounge_date,lounge_img)
		values (
			null,
			#{lounge_pet_type},
			#{member_user_id},
			#{lounge_title},
			#{lounge_content},
			(SELECT nickname FROM member WHERE user_id = #{member_user_id}), 
			now(),
			#{lounge_img}
			)
	</insert>
	
	<update id="update" parameterType="loungeVO">
		update lounge 
		set 
			lounge_pet_type = #{lounge_pet_type},
			lounge_title = #{lounge_title},
			lounge_content = #{lounge_content},
			lounge_img = #{lounge_img},
			lounge_date = now()
		where lounge_id = #{lounge_id}
	</update>
	
	<delete id="delete" parameterType="loungeVO">
		delete from lounge where lounge_id = #{lounge_id}
	</delete>
	
	<select id="one" parameterType="int" resultType="loungeVO">
		select * from lounge where lounge_id = #{lounge_id}
	</select>
	
	<sql id="search">
	         (select row_number() over(order by lounge_id desc) as lounge_no,
	             lounge_id, lounge_pet_type, lounge_title, lounge_content, 
	             lounge_writer, lounge_date
	          from lounge) l2
	           <choose>
		          <when test="searchType='all'">
			            where lounge_title like CONCAT('%',#{keyWord},'%')
						or lounge_content like CONCAT('%', #{keyWord}, '%')
		                or lounge_writer like CONCAT('%', #{keyWord}, '%')
						and l2.lounge_no between #{start} and #{end}
		          </when>
		          <when test="searchType='titleContent'">
			            where (lounge_title like CONCAT('%', #{keyWord}, '%') 
                         or lounge_content like CONCAT('%', #{keyWord}, '%'))
						and l2.lounge_no between #{start} and #{end}
		          </when>
		          <when test="searchType='reply'">
			            where reply_column like CONCAT('%', #{keyWord}, '%')
						and l2.lounge_no between #{start} and #{end}
		          </when>
	          	  <otherwise>
	          	  		where l2.lounge_no between #{start} and #{end}
	          	   </otherwise>	          	  
	          </choose> 
	</sql>
	
	<select id="list" parameterType="loungePageVO" resultType="loungeVO">
			select * from
	         <include refid="search"></include> 
	</select>
	
	<select id="count" resultType="int">
		<if test="keyWord == null">
		select count(*) from lounge
		</if>
		<if test="keyWord != null">
			select count(*) from
		 	<include refid="search"></include>
		</if>		
	</select>

</mapper>